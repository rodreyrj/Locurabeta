<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Versat Lite Pro - Control Total</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2canvas para generar imagen del recibo -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #0f172a; overflow-x: hidden; }
        
        .sidebar-item.active { background-color: #1e293b; color: #f8fafc; border-right: 4px solid #3b82f6; }
        .view-section { animation: fadeIn 0.2s ease-out; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column; gap: 10px;
        }

        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; padding: 0; }
        }
        .print-only { display: none; }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        .mobile-center-btn:active {
            transform: scale(0.9);
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: all 0.2s;
        }

        /* LOGIN MODAL (simple, full-screen, blocks UI) */
        .login-backdrop { background: rgba(0,0,0,0.55); z-index: 99999; }
        .login-modal { max-width:420px; width:95%; margin: 16px; border-radius: 10px; }
        .login-hidden { display:none; }

        /* UPLOAD OVERLAY (only added ‚Äî text modified + pricing card) */
        #uploadOverlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(2,6,23,0.65);
            z-index: 160000;
        }
        #uploadCard {
            background: #fff;
            width: 94%;
            max-width: 720px;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(2,6,23,0.45);
            text-align: left;
        }
        #uploadMsg { color:#dc2626; font-size:13px; min-height:18px; text-align:center; margin-top:10px; }

        /* pricing card inside overlay */
        .pricing-card { max-width: 320px; border-radius: 12px; border: 1px solid #e6e6e6; padding: 16px; display:inline-block; background:#ffffff; }
        .pricing-price { font-size: 28px; font-weight: 800; color:#0f172a; }
        .pricing-currency { font-size: 14px; color:#6b7280; margin-left:6px; }
        .pricing-buy { margin-top:12px; display:block; width:100%; text-align:center; padding:10px;background:#059669;color:#fff;border-radius:10px;text-decoration:none;font-weight:700; }
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">

    <!-- UPLOAD OVERLAY: instruction modified and pricing card added -->
    <div id="uploadOverlay" aria-live="polite">
      <div id="uploadCard">
        <h2 class="text-2xl font-extrabold text-center mb-2">Autenticaci√≥n requerida</h2>

        <!-- Instruction text (user requested short instruction without code) -->
        <p class="text-sm text-slate-600 text-center mb-6">
          Usa el archivo enviado por el vendedor para autentificar tu aplicaci√≥n.
        </p>

        <div class="flex flex-col md:flex-row items-center justify-center gap-6">
          <div class="flex flex-col items-center gap-3">
            <input id="uploadInput" type="file" accept=".json,application/json" class="hidden" />
            <label for="uploadInput" class="cursor-pointer bg-slate-900 text-white px-5 py-2 rounded font-bold">Seleccionar archivo</label>
            <p id="uploadMsg" class="mt-2 text-sm text-red-500"></p>
          </div>

          <!-- Pricing card as requested: 50 CUP and Comprar -> opens WhatsApp -->
          <div class="pricing-card">
            <div style="text-align:center">
              <h3 style="margin:0;font-weight:800">Archivo de Autentificaci√≥n</h3>
              <p style="margin:6px 0 0;color:#6b7280;font-size:13px">Entrega segura para activar tu app</p>
            </div>

            <div style="display:flex;align-items:center;justify-content:center;margin-top:12px">
              <span class="pricing-price">50</span><span class="pricing-currency">CUP</span>
            </div>

            <a id="buyBtn" class="pricing-buy" href="#" role="button" aria-label="Comprar archivo de autenticaci√≥n">Comprar</a>
          </div>
        </div>
      </div>
    </div>

    <div id="toast-container"></div>

    <!-- SIDEBAR PC -->
    <aside class="no-print hidden md:flex flex-col w-64 bg-slate-900 text-slate-300 h-screen sticky top-0 shadow-2xl">
        <div class="p-6">
            <h1 class="text-xl font-extrabold text-white flex items-center gap-2 italic">
                <span class="bg-blue-600 p-1.5 rounded-lg not-italic font-sans text-sm">V</span> Versat Pro
            </h1>
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1">Sistemas Contables</p>
        </div>
        
        <nav class="flex-1 px-3 space-y-1">
            <button onclick="navTo('dashboard')" id="pc-btn-dashboard" class="sidebar-item active w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-semibold">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                Caja Diaria
            </button>
            <button onclick="navTo('reports')" id="pc-btn-reports" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-semibold hover:bg-slate-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                Balance y Reportes
            </button>
            <button onclick="navTo('config')" id="pc-btn-config" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-semibold hover:bg-slate-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37a1.724 1.724 0 002.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                Ajustes de Caja
            </button>
            <button onclick="navTo('backup')" id="pc-btn-backup" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-semibold hover:bg-slate-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                Importar/Exportar
            </button>
        </nav>
    </aside>

    <!-- CABECERA M√ìVIL -->
    <nav class="md:hidden bg-slate-900 text-white p-4 sticky top-0 z-50 flex justify-between items-center no-print shadow-lg">
        <h1 class="font-bold flex items-center gap-2 text-sm"><span class="bg-blue-600 px-1.5 rounded">V</span> Versat Pro</h1>
        <div class="flex flex-col items-end">
            <span class="text-[9px] uppercase font-black text-slate-500 tracking-tighter">Efectivo Total</span>
            <div id="mob-saldo" class="text-sm font-black text-green-400 leading-none">$0</div>
        </div>
    </nav>

    <!-- CUERPO PRINCIPAL -->
    <main class="flex-1 flex flex-col min-h-screen no-print pb-24 md:pb-0">
        <section class="p-4 md:p-8 flex-1 max-w-6xl mx-auto w-full">
            
            <!-- VISTA DASHBOARD -->
            <div id="view-dashboard" class="view-section">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-6">
                    <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-200 col-span-2 md:col-span-1 flex flex-col justify-center">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Efectivo en Caja</p>
                        <h2 id="saldo-box" class="text-3xl font-black text-slate-900 leading-none tracking-tight">$0</h2>
                    </div>
                    <div class="bg-green-50 p-5 rounded-[2rem] border border-green-100">
                        <p class="text-[10px] font-bold text-green-600 uppercase tracking-widest mb-1">Ingresos Hoy</p>
                        <h2 id="ingresos-hoy" class="text-xl font-black text-green-700">$0</h2>
                    </div>
                    <div class="bg-red-50 p-5 rounded-[2rem] border border-red-100">
                        <p class="text-[10px] font-bold text-red-600 uppercase tracking-widest mb-1">Gastos Hoy</p>
                        <h2 id="gastos-hoy" class="text-xl font-black text-red-700">$0</h2>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    <div class="lg:col-span-5">
                        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl border border-slate-200">
                            <h3 class="font-black text-slate-800 mb-6 flex justify-between items-center text-xs uppercase tracking-tight">
                                Nueva Operaci√≥n
                                <span class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-[9px] font-bold">CAJA ABIERTA</span>
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 mb-1 block">Categor√≠a</label>
                                    <select id="main-cat" onchange="updateButtons()" class="w-full p-4 bg-slate-50 border-none rounded-2xl outline-none font-bold text-slate-700 appearance-none shadow-inner cursor-pointer">
                                        <option value="Ventas">üí∞ Venta de Producto (+)</option>
                                        <option value="Servicios">üõ†Ô∏è Servicio T√©cnico (+)</option>
                                        <option value="Gastos">üõí Gasto de Local (-)</option>
                                        <option value="Salarios">üë§ Pago de Personal (-)</option>
                                        <option value="Suministros">üì¶ Compra Insumos (-)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 mb-1 block">Descripci√≥n</label>
                                    <input type="text" id="desc" placeholder="¬øQu√© se cobr√≥ o pag√≥?" class="w-full p-4 bg-slate-50 border-none rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 shadow-inner">
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 mb-1 block">Monto (CUP)</label>
                                    <input type="number" id="monto" placeholder="0" class="w-full p-4 bg-slate-50 border-none rounded-2xl outline-none font-black text-2xl shadow-inner" inputmode="decimal">
                                </div>
                                <div id="btn-container" class="pt-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-7">
                        <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-200">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest">Movimientos de Hoy</h3>
                                <button onclick="txs = txs.filter(t => t.date !== new Date().toLocaleDateString('es-CU')); localStorage.setItem('versat_pro_txs', JSON.stringify(txs)); renderDashboard();" class="text-[10px] font-bold text-red-400 hover:text-red-600 uppercase tracking-tighter">Limpiar</button>
                            </div>
                            <div id="tx-list" class="space-y-3 max-h-[500px] overflow-y-auto pr-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VISTA AJUSTES DE CAJA -->
            <div id="view-config" class="view-section hidden">
                <div class="max-w-xl mx-auto">
                    <div class="bg-white p-8 rounded-[3rem] shadow-xl border border-slate-200">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            </div>
                            <h2 class="text-2xl font-black text-slate-800">Ajustes de Caja</h2>
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-2">Configura tu base de dinero</p>
                        </div>

                        <div class="space-y-6">
                            <div class="bg-slate-50 p-6 rounded-[2rem] border border-slate-100 text-center">
                                <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">Saldo Inicial Actual</span>
                                <h3 id="current-initial-display" class="text-3xl font-black text-blue-600 leading-none">$0</h3>
                            </div>

                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 mb-1 block">Nuevo Saldo Inicial (CUP)</label>
                                <input type="number" id="input-initial-balance" placeholder="Ej: 5000" class="w-full p-5 bg-slate-50 border-none rounded-2xl outline-none font-black text-xl shadow-inner focus:ring-2 focus:ring-blue-500" inputmode="decimal">
                                <p class="text-[10px] text-slate-400 mt-2 px-2">Escribe aqu√≠ el dinero con el que abres la caja f√≠sica.</p>
                            </div>

                            <button onclick="updateInitialBalanceSection()" class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-lg shadow-blue-200 transition-all text-sm uppercase tracking-wider active:scale-95">
                                ACTUALIZAR SALDO BASE
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VISTA REPORTES -->
            <div id="view-reports" class="view-section hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-slate-900 p-8 rounded-[3rem] text-white shadow-2xl">
                        <h2 class="text-4xl font-black mb-2" id="rep-utilidad">$0</h2>
                        <p class="text-slate-400 text-sm font-bold uppercase tracking-widest">Utilidad Neta (Hoy)</p>
                    </div>
                    <div class="bg-white p-8 rounded-[3rem] border border-slate-200">
                        <div class="flex justify-between items-center mb-4">
                             <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Resumen de Cierre</p>
                             <span id="rep-date" class="text-[10px] bg-slate-100 px-2 py-1 rounded font-bold">--</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm"><span class="text-slate-500">Saldo Inicial:</span> <span id="rep-sinicial" class="font-bold"></span></div>
                            <div class="flex justify-between text-sm"><span class="text-slate-500">Ingresos:</span> <span id="rep-tingresos" class="font-bold text-green-600"></span></div>
                            <div class="flex justify-between text-sm"><span class="text-slate-500">Egresos:</span> <span id="rep-tegresos" class="font-bold text-red-600"></span></div>
                            <div class="pt-2 border-t border-dashed flex justify-between font-black"><span class="text-slate-800">Saldo Final:</span> <span id="rep-sfinal"></span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VISTA BACKUP -->
            <div id="view-backup" class="view-section hidden">
                <div class="bg-white p-8 rounded-[3rem] border border-slate-200 shadow-sm max-w-2xl mx-auto">
                    <h2 class="text-2xl font-black text-slate-800 mb-6 text-center">Respaldo de Datos</h2>
                    <div class="grid grid-cols-1 gap-4">
                        <button onclick="exportData()" class="flex items-center justify-between p-6 bg-slate-900 text-white rounded-[2rem] hover:bg-black transition-all">
                            <div class="text-left">
                                <span class="block font-bold">Exportar Todo</span>
                                <span class="text-[10px] text-slate-400">Descarga un archivo JSON de respaldo</span>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                        </button>
                        <label class="flex items-center justify-between p-6 bg-orange-600 text-white rounded-[2rem] hover:bg-orange-700 transition-all cursor-pointer">
                            <div class="text-left">
                                <span class="block font-bold">Importar Archivo</span>
                                <span class="text-[10px] text-orange-200">Restaura datos desde un backup</span>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                            <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(event)">
                        </label>
                    </div>
                </div>
            </div>

        </section>

        <!-- NAVEGACI√ìN M√ìVIL -->
        <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 px-2 py-3 flex justify-around items-center z-50 rounded-t-[2.5rem] shadow-[0_-15px_30px_rgba(0,0,0,0.08)]">
            <button onclick="navTo('dashboard')" id="mob-btn-dashboard" class="flex flex-col items-center flex-1 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                <span class="text-[9px] font-black uppercase mt-1">Caja</span>
            </button>
            <button onclick="navTo('reports')" id="mob-btn-reports" class="flex flex-col items-center flex-1 text-slate-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                <span class="text-[9px] font-black uppercase mt-1">Balance</span>
            </button>
            <button onclick="navTo('config')" id="mob-btn-config" class="mobile-center-btn flex-1 flex flex-col items-center transition-all text-slate-400">
                <div class="bg-blue-600 text-white p-3.5 rounded-full -mt-10 border-4 border-white shadow-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>
                <span class="text-[9px] font-black uppercase mt-1">Ajuste I.</span>
            </button>
            <button onclick="navTo('backup')" id="mob-btn-backup" class="flex flex-col items-center flex-1 text-slate-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                <span class="text-[9px] font-black uppercase mt-1">Backup</span>
            </button>
        </nav>
    </main>

    <!-- √ÅREA DE IMPRESI√ìN (FACTURA) -->
    <div class="print-only p-8 text-slate-900 bg-white" id="invoice-print">
        <div class="text-center border-b-2 border-slate-900 pb-4 mb-6">
            <h1 class="text-2xl font-black">VERSAT PRO - RECIBO</h1>
            <p class="text-xs uppercase font-bold tracking-widest mt-1">Control de Operaciones</p>
        </div>
        <div class="flex justify-between mb-8 text-sm">
            <div>
                <p class="font-bold">Fecha: <span id="print-date"></span></p>
                <p class="font-bold">Hora: <span id="print-time"></span></p>
            </div>
            <div class="text-right">
                <p class="font-bold">Nro: <span id="print-id"></span></p>
            </div>
        </div>
        <div class="mb-10">
            <div class="grid grid-cols-3 border-b border-slate-200 py-2 text-xs font-black uppercase tracking-widest">
                <span>Categor√≠a</span>
                <span>Descripci√≥n</span>
                <span class="text-right">Total</span>
            </div>
            <div class="grid grid-cols-3 py-4 text-sm font-medium">
                <span id="print-cat"></span>
                <span id="print-desc"></span>
                <span id="print-val" class="text-right font-black"></span>
            </div>
        </div>
        <div class="text-center border-t border-slate-200 pt-6">
            <p class="text-[10px] font-bold uppercase tracking-widest">¬°Gracias por su gesti√≥n!</p>
        </div>
    </div>

    <script>
        // === Your original app script (unchanged) ===
        let txs = JSON.parse(localStorage.getItem('versat_pro_txs')) || [];
        let config = JSON.parse(localStorage.getItem('versat_pro_config')) || { initialBalance: 0 };

        function showToast(type, message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-600 text-white' : 'bg-blue-600 text-white';
            
            toast.innerHTML = `
                <div class="${bgColor} px-4 py-2 rounded shadow">${message}</div>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 2800);
        }

        function navTo(view) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.add('hidden'));
            const targetView = document.getElementById('view-' + view);
            if(targetView) targetView.classList.remove('hidden');
            
            document.querySelectorAll('.sidebar-item').forEach(btn => btn.classList.remove('active'));
            const pcBtn = document.getElementById('pc-btn-' + view);
            if(pcBtn) pcBtn.classList.add('active');
            
            if (view === 'reports') renderReports();
            if (view === 'config') renderConfigView();
        }

        function renderConfigView() {
            document.getElementById('current-initial-display').innerText = format(config.initialBalance);
            document.getElementById('input-initial-balance').value = '';
        }

        function updateInitialBalanceSection() {
            const input = document.getElementById('input-initial-balance');
            const val = parseFloat(input.value);
            
            if (!isNaN(val)) {
                config.initialBalance = val;
                localStorage.setItem('versat_pro_config', JSON.stringify(config));
                showToast('success', 'Saldo inicial guardado');
                renderDashboard();
                renderConfigView();
                setTimeout(() => navTo('dashboard'), 600);
            } else {
                showToast('error', 'Ingresa un n√∫mero v√°lido');
            }
        }

        function updateButtons() {
            const cat = document.getElementById('main-cat').value;
            const container = document.getElementById('btn-container');
            const isIncome = ['Ventas', 'Servicios'].includes(cat);
            const btnColor = isIncome ? 'bg-green-600 hover:bg-green-700' : 'bg-slate-900 hover:bg-black';

            container.innerHTML = `
                <button onclick="save('${isIncome ? 'ingreso' : 'gasto'}')" 
                        class="w-full ${btnColor} text-white font-black py-5 rounded-2xl shadow-lg transition-all text-sm uppercase tracking-wider active:scale-95">
                    GUARDAR ${cat}
                </button>`;
        }

        function save(type) {
            const desc = document.getElementById('desc').value.trim();
            const monto = parseFloat(document.getElementById('monto').value);
            const cat = document.getElementById('main-cat').value;

            if(!desc || isNaN(monto) || monto <= 0) {
                showToast('error', 'Completa descripci√≥n y monto');
                return;
            }

            if (type === 'gasto') {
                const actual = txs.reduce((a, b) => a + b.val, config.initialBalance);
                if (monto > actual) {
                    showToast('error', 'No hay dinero suficiente');
                    return;
                }
            }

            txs.unshift({
                id: 'V' + Math.floor(Math.random() * 99999),
                desc, cat, val: type === 'gasto' ? -monto : monto,
                time: new Date().toLocaleTimeString('es-CU', { hour: '2-digit', minute: '2-digit' }),
                date: new Date().toLocaleDateString('es-CU')
            });

            localStorage.setItem('versat_pro_txs', JSON.stringify(txs));
            document.getElementById('desc').value = '';
            document.getElementById('monto').value = '';
            showToast('success', 'Operaci√≥n registrada');
            renderDashboard();
        }

        function renderDashboard() {
            const list = document.getElementById('tx-list');
            const hoy = new Date().toLocaleDateString('es-CU');
            let ing = 0, gas = 0;
            const total = txs.reduce((a, b) => a + b.val, config.initialBalance);

            list.innerHTML = '';
            txs.forEach(t => {
                if(t.date === hoy) {
                    if(t.val > 0) ing += t.val; else gas += Math.abs(t.val);
                    const isPos = t.val > 0;
                    const el = document.createElement('div');
                    el.className = "flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-white rounded-2xl border border-slate-100 shadow-sm gap-4";
                    el.innerHTML = `
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center font-black text-xs ${isPos ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">${t.cat[0]}</div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-sm">${t.desc}</h4>
                                <p class="text-[9px] text-slate-400 font-bold uppercase tracking-tighter">${t.cat} ‚Ä¢ ${t.time}</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between sm:justify-end gap-4">
                            <span class="font-black text-sm ${isPos ? 'text-green-600' : 'text-red-600'}">${format(t.val)}</span>
                            <div class="flex gap-2">
                                <button onclick="sendWhatsApp('${t.id}')" title="Enviar por WhatsApp" class="action-btn bg-green-500 text-white hover:bg-green-600 shadow-md">W</button>
                                <button onclick="printInvoice('${t.id}')" title="Ver Factura PDF" class="action-btn bg-blue-600 text-white hover:bg-blue-700 shadow-md">P</button>
                                <button onclick="deleteTx('${t.id}')" title="Eliminar Registro" class="action-btn bg-red-600 text-white hover:bg-red-700 shadow-md">X</button>
                            </div>
                        </div>`;
                    list.appendChild(el);
                }
            });

            if(!list.innerHTML) list.innerHTML = `<p class="text-center py-10 text-slate-300 font-bold text-[9px] uppercase italic">Sin actividad registrada hoy</p>`;

            document.getElementById('saldo-box').innerText = format(total);
            document.getElementById('mob-saldo').innerText = format(total);
            document.getElementById('ingresos-hoy').innerText = format(ing);
            document.getElementById('gastos-hoy').innerText = format(gas);
        }

        function format(n) {
            const absN = Math.abs(n);
            const val = Number.isInteger(absN) ? absN : absN.toFixed(2);
            return `$${val}`;
        }

        function deleteTx(id) {
            txs = txs.filter(t => t.id !== id);
            localStorage.setItem('versat_pro_txs', JSON.stringify(txs));
            renderDashboard();
            showToast('success', 'Registro eliminado correctamente');
        }

        function printInvoice(id) {
            const t = txs.find(x => x.id === id);
            if(!t) return;
            
            document.getElementById('print-date').innerText = t.date;
            document.getElementById('print-time').innerText = t.time;
            document.getElementById('print-id').innerText = t.id;
            document.getElementById('print-cat').innerText = t.cat;
            document.getElementById('print-desc').innerText = t.desc;
            document.getElementById('print-val').innerText = format(t.val);
            
            window.print();
        }

        async function sendWhatsApp(id) {
            const t = txs.find(x => x.id === id);
            if (!t) { showToast('error', 'Registro no encontrado'); return; }
            const fallbackText = `Recibo ${t.id} - ${t.cat} - ${t.desc} - ${format(t.val)}`;
            window.open(`https://wa.me/56639178?text=${encodeURIComponent(fallbackText)}`, '_blank');
        }

        function renderReports() {
            const hoy = new Date().toLocaleDateString('es-CU');
            const dataHoy = txs.filter(t => t.date === hoy);
            const ing = dataHoy.filter(t => t.val > 0).reduce((a,b) => a + b.val, 0);
            const gas = dataHoy.filter(t => t.val < 0).reduce((a,b) => a + Math.abs(b.val), 0);

            document.getElementById('rep-utilidad') && (document.getElementById('rep-utilidad').innerText = format(ing - gas));
            document.getElementById('rep-date') && (document.getElementById('rep-date').innerText = hoy);
            document.getElementById('rep-sinicial') && (document.getElementById('rep-sinicial').innerText = format(config.initialBalance));
            document.getElementById('rep-tingresos') && (document.getElementById('rep-tingresos').innerText = `+${format(ing)}`);
            document.getElementById('rep-tegresos') && (document.getElementById('rep-tegresos').innerText = `-${format(gas)}`);
            document.getElementById('rep-sfinal') && (document.getElementById('rep-sfinal').innerText = format(config.initialBalance + (ing - gas)));
        }

        function exportData() {
            const blob = new Blob([JSON.stringify({txs, config}, null, 2)], {type:'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `Versat_Pro_Backup.json`;
            a.click();
            showToast('success', 'Backup descargado');
        }

        function importData(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const d = JSON.parse(ev.target.result);
                    txs = d.txs || []; 
                    config = d.config || { initialBalance: 0 };
                    localStorage.setItem('versat_pro_txs', JSON.stringify(txs));
                    localStorage.setItem('versat_pro_config', JSON.stringify(config));
                    renderDashboard();
                    showToast('success', 'Datos restaurados con √©xito');
                } catch (err) {
                    showToast('error', 'El archivo no es v√°lido');
                }
            };
            reader.readAsText(file);
        }

        updateButtons();
        renderDashboard();

        // === Overlay logic (keeps only the upload behaviour; text changed + buy button) ===
        (function(){
          const overlay = document.getElementById('uploadOverlay');
          const input = document.getElementById('uploadInput');
          const msg = document.getElementById('uploadMsg');
          const buyBtn = document.getElementById('buyBtn');

          function extractEmails(obj){
            const re = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-z]{2,}/gi;
            const found = new Set();
            const seen = new WeakSet();
            function walk(x){
              if (!x || typeof x === 'number' || typeof x === 'boolean') return;
              if (typeof x === 'string'){ const m = x.match(re); if(m) m.forEach(s=>found.add(s.toLowerCase())); return; }
              if (typeof x === 'object'){ if(seen.has(x)) return; seen.add(x); if(Array.isArray(x)) x.forEach(walk); else Object.keys(x).forEach(k=>walk(x[k])); }
            }
            walk(obj);
            return Array.from(found);
          }

          function getSingleEmail(parsed){
            if (!parsed) return null;
            if (Array.isArray(parsed)){
              if (parsed.length === 1 && parsed[0] && typeof parsed[0] === 'object'){
                if (parsed[0].email) return parsed[0].email.toLowerCase();
                if (parsed[0].correo) return parsed[0].correo.toLowerCase();
                const e = extractEmails(parsed[0]); if (e.length === 1) return e[0];
                return null;
              }
              const e = extractEmails(parsed); if (e.length === 1) return e[0]; return null;
            } else if (typeof parsed === 'object'){
              if (parsed.email) return parsed.email.toLowerCase();
              if (parsed.correo) return parsed.correo.toLowerCase();
              if (parsed.user_email) return parsed.user_email.toLowerCase();
              const e = extractEmails(parsed); if (e.length === 1) return e[0]; return null;
            }
            return null;
          }

          input.addEventListener('change', async (ev) => {
            msg.textContent = '';
            const f = ev.target.files && ev.target.files[0];
            if (!f) { msg.textContent = 'No seleccion√≥ archivo.'; return; }
            if (f.size > 3_000_000) { msg.textContent = 'Archivo demasiado grande.'; return; }
            try {
              const txt = await f.text();
              let parsed;
              try { parsed = JSON.parse(txt); } catch(e){ msg.textContent = 'JSON inv√°lido.'; return; }
              const email = getSingleEmail(parsed);
              if (!email) { msg.textContent = 'El JSON debe contener exactamente UN correo (un solo usuario).'; return; }
              if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { msg.textContent = 'Correo detectado no v√°lido.'; return; }

              // save uploaded file and email to localStorage
              try {
                localStorage.setItem('aut.json', txt);
                localStorage.setItem('vp_user_email', email);
              } catch (err) {
                console.error(err);
                msg.textContent = 'No se pudo guardar en localStorage (modo privado o sin espacio).';
                return;
              }

              showToast('success','Archivo subido y guardado (aut.json). Abriendo aplicaci√≥n...');
              try { overlay.remove(); } catch(e){}
              try { if (typeof updateButtons === 'function') updateButtons(); } catch(e){}
              try { if (typeof renderDashboard === 'function') renderDashboard(); } catch(e){}
              try { if (typeof renderReports === 'function') renderReports(); } catch(e){}
            } catch (err) {
              console.error(err);
              msg.textContent = 'Error leyendo el archivo.';
            }
          });

          // buy button opens WhatsApp to the provided number with a short message
          buyBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const phone = '56639178';
            const text = 'Me interesa obtener un archivo de autentificar para la app';
            window.open(`https://wa.me/${encodeURIComponent(phone)}?text=${encodeURIComponent(text)}`, '_blank');
          });

          // show overlay only when no stored aut.json + vp_user_email
          window.addEventListener('DOMContentLoaded', () => {
            const storedJson = localStorage.getItem('aut.json');
            const storedEmail = localStorage.getItem('vp_user_email');
            if (storedJson && storedEmail && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(storedEmail)) {
              try { document.getElementById('uploadOverlay').remove(); } catch(e){}
              return;
            }
            // else overlay remains visible (in DOM) and blocks app until user uploads
          });
        })();
    </script>
</body> 
</html>
